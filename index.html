<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Info Sekolah Depok</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f0f4f8; }
        .school-card:hover { transform: translateY(-5px); transition: all 0.3s; }
        .loader { 
            border: 4px solid #e5e7eb; border-top: 4px solid #2563eb; 
            border-radius: 50%; width: 40px; height: 40px; 
            animation: spin 1s linear infinite; margin: 20px auto; 
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .snap-x::-webkit-scrollbar { height: 6px; }
        .snap-x::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 10px; }
        .snap-x::-webkit-scrollbar-track { background-color: transparent; }
    </style>
</head>
<body>

    <!-- NAVBAR -->
    <nav class="bg-blue-900 text-white p-4 shadow-lg sticky top-0 z-50">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-xl font-bold flex items-center gap-2">
                <i class="fas fa-graduation-cap text-yellow-400"></i> Sekolah Depok Hub
            </h1>
            <a id="btnAdmin" href="#" target="_blank" class="text-xs md:text-sm bg-blue-800 border border-blue-600 px-4 py-2 rounded-full hover:bg-blue-700 transition">
                <i class="fas fa-database mr-1"></i> Data Induk
            </a>
        </div>
    </nav>

    <!-- HERO SECTION -->
    <div class="bg-gradient-to-br from-blue-900 to-blue-700 pb-24 pt-10 px-4 rounded-b-[3rem] shadow-xl relative overflow-hidden">
        <div class="absolute inset-0 opacity-10 pointer-events-none">
            <i class="fas fa-book absolute top-10 left-10 text-9xl text-white transform -rotate-12"></i>
            <i class="fas fa-school absolute bottom-10 right-10 text-9xl text-white transform rotate-12"></i>
        </div>

        <div class="container mx-auto relative z-10">
            <div class="text-center mb-10">
                <h2 class="text-3xl md:text-5xl font-extrabold text-white mb-3 drop-shadow-md">Pusat Info Sekolah Depok</h2>
                <p class="text-blue-100 text-lg md:text-xl font-light">Data Resmi Terintegrasi Dapodik & Kemenag</p>
            </div>

            <!-- AREA PENGUMUMAN -->
            <div id="announcementSection" class="hidden mb-10 max-w-6xl mx-auto">
                <div class="flex items-center gap-2 mb-4 px-2">
                    <span class="bg-orange-500 text-white text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wider animate-pulse">Papan Pengumuman</span>
                </div>
                <div id="announcementList" class="flex gap-4 overflow-x-auto snap-x snap-mandatory pb-6 px-2"></div>
            </div>

            <!-- SEARCH BOX -->
            <div class="bg-white/95 backdrop-blur p-6 rounded-2xl shadow-2xl max-w-5xl mx-auto border border-white/20">
                <div class="grid grid-cols-1 md:grid-cols-12 gap-4">
                    <div class="md:col-span-5 relative">
                        <i class="fas fa-search absolute left-4 top-4 text-gray-400"></i>
                        <input type="text" id="searchInput" placeholder="Cari nama sekolah (Contoh: SMAN 1)..." class="pl-12 bg-gray-50 border-0 ring-1 ring-gray-200 p-3.5 rounded-xl w-full focus:ring-2 focus:ring-blue-500 transition font-medium text-gray-700">
                    </div>
                    <div class="md:col-span-3">
                        <select id="stageFilter" class="bg-gray-50 border-0 ring-1 ring-gray-200 p-3.5 rounded-xl w-full text-gray-700 cursor-pointer focus:ring-2 focus:ring-blue-500 transition">
                            <option value="">Semua Jenjang</option>
                            <option value="SD">SD / MI</option>
                            <option value="SMP">SMP / MTs</option>
                            <option value="SMA">SMA / SMK / MA</option>
                            <option value="TK">TK / RA / PAUD</option>
                            <option value="KB">Kelompok Bermain (KB)</option>
                            <option value="PKBM">PKBM / Non Formal</option>
                        </select>
                    </div>
                    <div class="md:col-span-4">
                        <select id="districtFilter" class="bg-gray-50 border-0 ring-1 ring-gray-200 p-3.5 rounded-xl w-full text-gray-700 cursor-pointer focus:ring-2 focus:ring-blue-500 transition">
                            <option value="">Semua Kecamatan</option>
                            <option value="Beji">Beji</option>
                            <option value="Pancoran Mas">Pancoran Mas</option>
                            <option value="Cimanggis">Cimanggis</option>
                            <option value="Sukmajaya">Sukmajaya</option>
                            <option value="Cinere">Cinere</option>
                            <option value="Tapos">Tapos</option>
                            <option value="Sawangan">Sawangan</option>
                            <option value="Bojongsari">Bojongsari</option>
                            <option value="Cilodong">Cilodong</option>
                            <option value="Limo">Limo</option>
                            <option value="Cipayung">Cipayung</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MAIN CONTENT -->
    <div class="container mx-auto p-4 -mt-8 mb-20 relative z-10">
        <div id="loading" class="text-center bg-white p-10 rounded-3xl shadow-xl max-w-sm mx-auto mt-4">
            <div class="loader"></div>
            <p class="text-gray-600 font-medium mt-4">Menyiapkan Database Pendidikan...</p>
            <p class="text-xs text-gray-400 mt-2">Sedang memproses data dari Google Sheets...</p>
        </div>

        <div id="errorMsg" class="hidden text-center bg-white p-8 rounded-3xl shadow-xl border border-red-100 max-w-lg mx-auto mt-4">
            <div class="bg-red-50 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="fas fa-exclamation-triangle text-red-500 text-2xl"></i>
            </div>
            <h3 class="text-xl font-bold text-gray-800 mb-2">Data Gagal Dimuat</h3>
            <p id="errorTxt" class="text-gray-500 mb-6 text-sm">Kemungkinan: <br>1. Spreadsheet belum "Published to Web" sebagai CSV. <br>2. Browser memblokir akses data (CORS).</p>
            <div class="flex flex-col gap-2">
                <button onclick="window.location.reload()" class="bg-blue-600 text-white px-6 py-2.5 rounded-full font-medium hover:bg-blue-700 transition">Coba Lagi</button>
                <p class="text-[10px] text-gray-400">Saran: Jalankan file melalui web server (Live Server) atau upload ke hosting/GitHub.</p>
            </div>
        </div>

        <div id="noResult" class="hidden text-center py-16">
            <div class="bg-gray-100 rounded-full w-24 h-24 flex items-center justify-center mx-auto mb-4">
                <i class="fas fa-search text-gray-300 text-4xl"></i>
            </div>
            <h3 class="text-lg font-bold text-gray-700">Tidak ditemukan</h3>
            <p class="text-gray-500">Coba ubah kata kunci atau filter.</p>
        </div>

        <div id="schoolList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 hidden"></div>
        <p id="dataCount" class="text-center text-gray-400 text-sm mt-8 hidden"></p>
    </div>

    <!-- MODAL DETAIL -->
    <div id="detailModal" class="fixed inset-0 bg-blue-900/90 hidden flex items-center justify-center z-[100] p-4 backdrop-blur-sm transition-opacity duration-300 opacity-0">
        <div class="bg-white rounded-3xl shadow-2xl max-w-2xl w-full overflow-hidden transform scale-95 transition-transform duration-300" id="modalContent">
            <div class="bg-gradient-to-r from-blue-800 to-blue-600 p-8 relative">
                <button onclick="closeModal()" class="absolute top-6 right-6 text-white/80 hover:text-white bg-white/10 hover:bg-white/20 rounded-full w-10 h-10 flex items-center justify-center transition backdrop-blur-md">
                    <i class="fas fa-times"></i>
                </button>
                <div class="pr-10">
                    <h3 id="modalName" class="text-2xl md:text-3xl font-bold text-white mb-2 leading-tight">Nama Sekolah</h3>
                    <div class="flex items-center text-blue-100 gap-3">
                        <span class="bg-white/20 px-3 py-1 rounded-full text-xs font-semibold backdrop-blur-md"><i class="fas fa-map-marker-alt mr-1"></i> <span id="modalDistrictHeader">Kecamatan</span></span>
                    </div>
                </div>
            </div>
            
            <div class="p-8 overflow-y-auto max-h-[60vh]">
                <div class="flex flex-wrap gap-3 mb-8">
                    <span id="modalStage" class="px-4 py-1.5 text-xs font-bold rounded-full bg-blue-50 text-blue-700 border border-blue-100 tracking-wide">JENJANG</span>
                    <span id="modalStatus" class="px-4 py-1.5 text-xs font-bold rounded-full bg-indigo-50 text-indigo-700 border border-indigo-100 tracking-wide">STATUS</span>
                    <span id="modalNPSN" class="px-4 py-1.5 text-xs font-bold rounded-full bg-gray-100 text-gray-600 border border-gray-200 tracking-wide">NPSN: -</span>
                </div>

                <div class="grid md:grid-cols-1 gap-6 mb-6">
                    <div class="flex gap-4 p-4 rounded-2xl bg-gray-50 border border-gray-100">
                        <div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 shrink-0"><i class="fas fa-map-pin"></i></div>
                        <div>
                            <p class="text-xs font-bold text-gray-400 uppercase mb-1">Alamat Lengkap</p>
                            <p id="modalAddress" class="text-gray-800 font-medium text-sm leading-snug">-</p>
                            <p id="modalKelurahan" class="text-gray-500 text-xs mt-1">-</p>
                        </div>
                    </div>
                </div>

                <div class="prose prose-sm text-gray-600 leading-relaxed mb-8 bg-blue-50 p-4 rounded-xl border border-blue-100">
                    <h4 class="text-blue-900 font-bold mb-1 text-xs uppercase">Pembina / Kementerian</h4>
                    <p id="modalPembina" class="text-gray-800 font-medium">-</p>
                </div>

                <div class="grid grid-cols-1 gap-4 pt-4">
                    <a id="btnMaps" href="#" target="_blank" class="flex items-center justify-center gap-2 bg-blue-600 text-white py-3.5 rounded-xl hover:bg-blue-700 transition shadow-lg shadow-blue-200 font-bold transform active:scale-95">
                        <i class="fas fa-location-arrow text-xl"></i> Lihat di Peta Google
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- KONFIGURASI URL ---
        const URL_DATA_INDUK = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRZG9phJEFoDarXmWEfy9rADhrk_OrDwXeRXvTPTES07UioRqwJeXSEuaIFhaY4Fg/pub?gid=1661834458&single=true&output=csv";
        const URL_PENGUMUMAN = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRZLBXcIag1hBoqwQN4D5Vr8sLt1rNs-xOvIQno3aD1elmb1LNn4JXlBpPXsxtJs4pRlgQH3jkhfyaK/pub?gid=944287724&single=true&output=csv";

        let schoolsData = [];

        // FUNGSI PINTAR: Mencari baris Header otomatis dengan toleransi tinggi
        function parseSmartCSV(rawData) {
            if (!rawData || rawData.length === 0) return [];
            
            let headerRowIndex = -1;
            // Cari kata kunci di 15 baris pertama
            for (let i = 0; i < Math.min(15, rawData.length); i++) {
                const rowStr = rawData[i].join('|').toLowerCase();
                // Harus mengandung 'npsn' DAN 'nama' (kata kunci utama data sekolah)
                if (rowStr.includes('npsn') && (rowStr.includes('nama') || rowStr.includes('satuan'))) {
                    headerRowIndex = i;
                    break;
                }
            }

            if (headerRowIndex === -1) {
                console.error("Format header tidak ditemukan di 15 baris pertama.");
                return []; 
            }

            // Normalisasi Nama Header agar mudah dipanggil (Trim & Proper Case internal)
            const rawHeaders = rawData[headerRowIndex];
            const headers = rawHeaders.map(h => h ? h.trim() : '');
            
            const mappedData = [];
            for (let i = headerRowIndex + 1; i < rawData.length; i++) {
                const row = rawData[i];
                if (!row || row.length < 2 || !row.join('').trim()) continue; // Skip baris kosong

                let obj = {};
                headers.forEach((key, index) => {
                    if (key) obj[key] = row[index] || '';
                });
                mappedData.push(obj);
            }
            return mappedData;
        }

        // --- ADAPTOR: Mengubah Data Mentah ke Format Aplikasi ---
        function mapDataInduk(rawData) {
            return rawData.map(item => {
                // Cari key secara case-insensitive jika user merubah judul kolom sedikit
                const getVal = (possibleKeys) => {
                    const foundKey = Object.keys(item).find(k => possibleKeys.includes(k.toLowerCase().trim()));
                    return foundKey ? item[foundKey] : '';
                };

                let cleanDistrict = getVal(['kecamatan', 'kec']) || '';
                cleanDistrict = cleanDistrict.replace(/KEC\.|KEC /i, '').trim();
                
                let rawStatus = getVal(['status']) || 'Umum';
                let cleanStatus = rawStatus.charAt(0).toUpperCase() + rawStatus.slice(1).toLowerCase();

                return {
                    name: getVal(['nama', 'nama satuan pendidikan', 'sekolah']) || '',
                    stage: getVal(['bentuk', 'jenjang', 'bentuk pendidikan']) || '-', 
                    status: cleanStatus,
                    district: cleanDistrict,
                    address: getVal(['alamat', 'alamat jalan']) || '',
                    npsn: getVal(['npsn']) || '',
                    kelurahan: getVal(['kelurahan', 'desa']) || '',
                    pembina: getVal(['pembina', 'instansi']) || '',
                };
            });
        }

        async function fetchCSV(url, isSmartMode = false) {
            try {
                const timestamp = new Date().getTime();
                const urlWithCache = url + "&t=" + timestamp;

                const response = await fetch(urlWithCache);
                if (!response.ok) throw new Error(`HTTP Error: ${response.status}`);
                
                const text = await response.text();
                
                return new Promise((resolve, reject) => {
                    Papa.parse(text, {
                        header: !isSmartMode, // Jika smart mode, kita cari header sendiri
                        skipEmptyLines: true,
                        complete: (results) => {
                            if (isSmartMode) {
                                const cleanData = parseSmartCSV(results.data);
                                resolve(cleanData);
                            } else {
                                resolve(results.data);
                            }
                        },
                        error: (err) => reject(err)
                    });
                });
            } catch (err) {
                console.error("Fetch Error:", err);
                return null; // Return null agar sistem tahu ada kegagalan fetch
            }
        }

        async function initApp() {
            try {
                // 1. Load Data Induk
                const rawData = await fetchCSV(URL_DATA_INDUK, true);
                
                if (rawData && rawData.length > 0) {
                    const mappedData = mapDataInduk(rawData);
                    schoolsData = mappedData.filter(i => i.name && i.name.trim() !== "");
                    
                    if(schoolsData.length === 0) throw new Error("Format kolom tidak cocok");

                    document.getElementById('loading').classList.add('hidden');
                    document.getElementById('schoolList').classList.remove('hidden');
                    document.getElementById('dataCount').innerText = `Menampilkan ${schoolsData.length} Data Satuan Pendidikan`;
                    document.getElementById('dataCount').classList.remove('hidden');
                    
                    renderSchools(schoolsData);
                } else {
                    throw new Error("Data Kosong atau Gagal Akses");
                }

                // 2. Load Pengumuman
                const announceData = await fetchCSV(URL_PENGUMUMAN, false);
                if(announceData && announceData.length > 0) {
                    const validAnnounce = announceData.filter(i => i.judul || i.Judul);
                    if(validAnnounce.length > 0) renderAnnouncements(validAnnounce);
                }

            } catch (e) {
                console.error("Init App Error:", e);
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('errorMsg').classList.remove('hidden');
                
                // Beri info lebih detail di console agar user tahu apa yang salah
                if (window.location.protocol === 'file:') {
                    document.getElementById('errorTxt').innerHTML = "<b>Deteksi:</b> Browser memblokir data karena file dibuka langsung.<br>Silakan gunakan <i>Live Server</i> di VS Code atau upload ke internet.";
                }
            }
        }

        function renderAnnouncements(data) {
            const container = document.getElementById('announcementList');
            const section = document.getElementById('announcementSection');
            section.classList.remove('hidden');
            container.innerHTML = '';
            
            data.forEach(info => {
                const title = info.judul || info.Judul || 'Info';
                const content = info.isi || info.Isi || '';
                const date = info.tanggal || info.Tanggal || '-';
                const link = info.link || info.Link || '';
                const color = (info.warna || info.Warna || '').toLowerCase();

                let cardStyle = 'bg-white border-l-4 border-blue-500 text-gray-800';
                let icon = 'fa-info-circle text-blue-500';
                
                if (color.includes('red')) { cardStyle = 'bg-red-50 border-l-4 border-red-500 text-red-900'; icon = 'fa-exclamation-triangle'; }
                if (color.includes('green')) { cardStyle = 'bg-green-50 border-l-4 border-green-500 text-green-900'; icon = 'fa-check-circle'; }
                
                const safeIsi = content.replace(/(https?:\/\/[^\s]+)/g, url => `<a href="${url}" target="_blank" class="underline text-blue-700 font-bold relative z-20">${url}</a>`);

                container.innerHTML += `
                    <div class="snap-center shrink-0 w-80 p-5 rounded-xl shadow-md ${cardStyle} relative group">
                        <div class="flex justify-between items-start mb-2"><span class="text-[10px] font-bold uppercase opacity-70 flex items-center gap-1"><i class="far fa-calendar-alt"></i> ${date}</span><i class="fas ${icon} text-lg"></i></div>
                        <h4 class="font-bold text-lg leading-tight mb-2">${title}</h4>
                        <p class="text-sm opacity-90 line-clamp-3 mb-3 leading-relaxed relative z-10">${safeIsi}</p>
                        ${link ? `<a href="${link}" target="_blank" class="text-xs font-bold underline decoration-2 relative z-20">Baca Selengkapnya &rarr;</a>` : ''}
                    </div>`;
            });
        }

        const schoolList = document.getElementById('schoolList');
        const noResult = document.getElementById('noResult');

        function renderSchools(data) {
            schoolList.innerHTML = '';
            if (data.length === 0) { noResult.classList.remove('hidden'); return; }
            noResult.classList.add('hidden');

            const displayLimit = 100;
            const displayData = data.slice(0, displayLimit); 

            displayData.forEach((school) => {
                const statusStr = (school.status || '').toLowerCase();
                const isNegeri = statusStr.includes('negeri');
                const badgeColor = isNegeri ? 'bg-indigo-100 text-indigo-700' : 'bg-emerald-100 text-emerald-700';
                
                let iconClass = 'fa-school'; 
                const stage = (school.stage || '').toUpperCase();
                if(['TK', 'RA', 'KB', 'PAUD'].some(s => stage.includes(s))) iconClass = 'fa-shapes';
                else if(['SD', 'MI'].some(s => stage.includes(s))) iconClass = 'fa-child';
                else if(['SMP', 'MTS'].some(s => stage.includes(s))) iconClass = 'fa-user-graduate';
                else if(['SMA', 'SMK', 'MA'].some(s => stage.includes(s))) iconClass = 'fa-university';

                const safeName = (school.name || 'Sekolah').replace(/'/g, "&apos;").replace(/"/g, "&quot;");

                schoolList.innerHTML += `
                    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden hover:shadow-xl hover:-translate-y-1 transition-all duration-300 cursor-pointer group flex flex-col h-full" onclick="openDetail('${safeName}')">
                        <div class="h-24 bg-gradient-to-r from-slate-50 to-slate-100 flex items-center justify-center relative overflow-hidden">
                            <i class="fas ${iconClass} text-5xl text-gray-300 group-hover:text-blue-600 transition-colors duration-300 relative z-10"></i>
                            <div class="absolute top-3 right-3 flex gap-1">
                                <span class="text-[10px] font-bold px-2.5 py-1 rounded-lg bg-white/80 backdrop-blur shadow-sm text-gray-600 border border-gray-200 uppercase tracking-wide">${school.stage}</span>
                            </div>
                        </div>
                        <div class="p-6 flex-grow flex flex-col">
                            <div class="flex flex-wrap gap-2 mb-3">
                                <span class="text-[10px] font-bold px-2 py-0.5 rounded ${badgeColor}">${school.status}</span>
                                <span class="text-[10px] font-bold px-2 py-0.5 rounded bg-gray-100 text-gray-600 flex items-center border border-gray-200"><i class="fas fa-map-marker-alt mr-1 text-gray-400"></i> ${school.district}</span>
                            </div>
                            <h3 class="font-bold text-gray-800 text-lg mb-1 leading-snug group-hover:text-blue-600 transition">${school.name}</h3>
                            <p class="text-xs text-gray-400 mb-3 line-clamp-2">${school.address || ''}</p>
                            <div class="pt-3 border-t border-gray-50 flex justify-between items-center text-xs font-semibold text-gray-400 mt-auto">
                                <span>NPSN: ${school.npsn || '-'}</span>
                                <span class="text-blue-600 group-hover:translate-x-1 transition flex items-center">Detail <i class="fas fa-arrow-right ml-1"></i></span>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            const total = data.length;
            document.getElementById('dataCount').innerText = total > displayLimit ? `Menampilkan ${displayLimit} dari ${total} sekolah (Gunakan pencarian)` : `Menampilkan ${total} Data Satuan Pendidikan`;
        }

        function filterSchools() {
            const q = document.getElementById('searchInput').value.toLowerCase();
            const stage = document.getElementById('stageFilter').value;
            const district = document.getElementById('districtFilter').value.toUpperCase();

            const filtered = schoolsData.filter(s => {
                const n = (s.name || '').toLowerCase();
                const st = (s.stage || '');
                const d = (s.district || '').toUpperCase();
                
                const matchName = n.includes(q);
                const matchStage = stage === '' || st.includes(stage.split(' ')[0]); 
                const matchDistrict = district === '' || d.includes(district);
                
                return matchName && matchStage && matchDistrict;
            });
            renderSchools(filtered);
        }

        ['searchInput', 'stageFilter', 'districtFilter'].forEach(id => {
            document.getElementById(id).addEventListener(id === 'searchInput' ? 'keyup' : 'change', filterSchools);
        });

        const modal = document.getElementById('detailModal');
        const modalContent = document.getElementById('modalContent');
        function openDetail(schoolName) {
            const name = schoolName.replace(/&apos;/g, "'").replace(/&quot;/g, '"');
            const school = schoolsData.find(s => s.name === name);
            if(!school) return;

            document.getElementById('modalName').innerText = school.name;
            document.getElementById('modalDistrictHeader').innerText = school.district || 'Depok';
            document.getElementById('modalAddress').innerText = school.address || '-';
            document.getElementById('modalKelurahan').innerText = school.kelurahan ? `Kel. ${school.kelurahan}` : '-';
            document.getElementById('modalPembina').innerText = school.pembina || '-';
            document.getElementById('modalStage').innerText = school.stage || '-';
            document.getElementById('modalStatus').innerText = school.status || '-';
            document.getElementById('modalNPSN').innerText = `NPSN: ${school.npsn || '-'}`;

            const mapsBtn = document.getElementById('btnMaps');
            mapsBtn.href = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(school.name + ' ' + school.address + ' Depok')}`;

            modal.classList.remove('hidden');
            setTimeout(() => { modal.classList.remove('opacity-0'); modalContent.classList.remove('scale-95'); modalContent.classList.add('scale-100'); }, 10);
        }
        function closeModal() {
            modal.classList.add('opacity-0'); modalContent.classList.remove('scale-100'); modalContent.classList.add('scale-95'); setTimeout(() => modal.classList.add('hidden'), 300);
        }
        modal.addEventListener('click', (e) => { if(e.target === modal) closeModal(); });

        // Mulai Aplikasi
        window.addEventListener('load', initApp);
    </script>
</body>
</html>